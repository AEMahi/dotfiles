#·····················································································
# Pre-Configuraion
#·····················································································
set -g prefix C-a

# Load Colors
source "$DOT/.colorscheme"

#·····················································································
# Configure Keybindings
#·····················································································
unbind -a

# Session Management
bind : command-prompt
bind r source "$DOT/tmux/tmux.conf"
bind T run 'tmux set status && tmux set pane-border-status'
bind t set pane-border-status
bind S choose-session
bind C-d detach
bind C-l refresh
bind C-x lock

# Window Management
bind '"' choose-window
bind C-c neww -c "$HOME"
bind N command-prompt "rename-window %%"
bind C-a last
bind C-w killw

# Pane Management
bind z resizep -Z
bind * setw synchronize-panes
bind P set pane-border-status
bind c killp
bind x swapp -D
bind n command-prompt "select-pane -T %%"

# Open panes in current directory
bind s splitw -v -c "#{pane_current_path}"
bind v splitw -h -c "#{pane_current_path}"

# Toggle Pane Size
bind -r -T prefix C-h resizep -L 5
bind -r -T prefix C-j resizep -D 5
bind -r -T prefix C-k resizep -U 5
bind -r -T prefix C-l resizep -R 5

# Other
bind -T copy-mode-vi v send -X begin-selection

#·····················································································
# Configure Options
#·····················································································

# Configure True color and 256 palette when possible
set -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "${TERM}"

# Configure Session Options
set -g status-interval 3
set -g status-position top
set -g detach-on-destroy off
set -g escape-time 0
set -g history-limit 1000000
set -g mouse on

# Configure Window and Pane Options
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
setw -g pane-base-index 1
setw -g mode-keys vi

#·····················································································
# Configure TPM
#·····················································································
set -g @plugin 'vivek-x-jha/tmux-catppuccin'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum' # Must be last in TPM plugin list

#·····················································································
# Configure Utility Plugins 
#·····················································································

# Floax
set -g @floax-border-color 'brightmagenta'
set -g @floax-text-color 'white'

# Resurrect
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Continuum
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'iterm,fullscreen'
set -g @continuum-restore 'on'

#·····················································································
# Configure Theme: Catppuccin
#·····················································································

# Status
set -g @catppuccin_status_background "default"
set -g @catppuccin_status_modules_left "session host user directory "
set -g @catppuccin_status_modules_right "gitmux date_time"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_middle_separator " "
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "all"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_status_justify "left"

# Windows
set -g @catppuccin_window_separator " "
set -g @catppuccin_window_status_enable "yes"
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_middle_separator ""
set -g @catppuccin_window_right_separator ""
set -g @catppuccin_window_number_position "left"

set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_color "default"
set -g @catppuccin_window_default_background "default"
set -g @catppuccin_window_default_text "#[fg=#{?window_last_flag,$red,$bright_black}]#W"
set -g @catppuccin_window_current_fill "number" 
set -g @catppuccin_window_current_color "default"
set -g @catppuccin_window_current_background "default"
set -g @catppuccin_window_current_text "#[fg=$green]#W"

set -g @catppuccin_icon_window_last "#[fg=$bright_red]⚡"
set -g @catppuccin_icon_window_current "#[fg=$bright_green] "
set -g @catppuccin_icon_window_zoom "#[fg=$bright_blue]󰼀 "
set -g @catppuccin_icon_window_mark "󰃀"
set -g @catppuccin_icon_window_silent "󰂛"
set -g @catppuccin_icon_window_activity "󰖲"
set -g @catppuccin_icon_window_bell "󰂞"

# Panes
set -g @catppuccin_pane_status_enabled "yes"
set -g @catppuccin_pane_border_status "top"
set -g @catppuccin_pane_left_separator "#[fg=$bright_magenta] "
set -g @catppuccin_pane_right_separator " #[fg=$bright_magenta]"
set -g @catppuccin_pane_default_fill "number"
set -g @catppuccin_pane_default_text "#[fg=$yellow]#{pane_title}"
set -g @catppuccin_pane_border_style "fg=$grey"
set -g @catppuccin_pane_active_border_style "fg=$bright_black"
set -g @catppuccin_pane_color "default"
set -g @catppuccin_pane_background_color "default"

# Session Module
set -g @catppuccin_session_icon "#[fg=#{?client_prefix,$bright_cyan,$bright_magenta}] "
set -g @catppuccin_session_color "default"
set -g @catppuccin_session_text "#[fg=#{?client_prefix,$bright_cyan,$bright_magenta}]#S"

# Host Module
set -g @catppuccin_host_icon "#[fg=$bright_yellow] "
set -g @catppuccin_host_color "default"
set -g @catppuccin_host_text "#[fg=$bright_yellow]#H"

# User Module
set -g @catppuccin_user_icon  "#[fg=$black] "
set -g @catppuccin_user_color "default"
set -g @catppuccin_user_text  "#[fg=$black]#(whoami)"

# Directory Module
set -g @catppuccin_directory_icon  "#[fg=$blue] "
set -g @catppuccin_directory_color "default"
set -g @catppuccin_directory_text  "#[fg=$blue]#{pane_current_path}"

# Date Time Module
set -g @catppuccin_date_time_icon  "#[fg=$bright_magenta] "
set -g @catppuccin_date_time_color "default"
set -g @catppuccin_date_time_text  "#[fg=$bright_magenta]%a %b %d %l:%M %p %Z"

# Gitmux Module
set -g @catppuccin_gitmux_icon  " "
set -g @catppuccin_gitmux_color "default"
set -g @catppuccin_gitmux_text  "#(gitmux -cfg $DOT/tmux/.gitmux.conf #{pane_current_path})"

#·····················································································
# Load Plugins
#·····················································································

# Message on successful config reload
display "#[fg=$magenta,align=absolute-centre]  #[fg=$green,align=absolute-centre]RELOAD SUCCESS #[fg=$blue]~/dotfiles/tmux/tmux.conf #[fg=$magenta]"

# Execute TPM - installs if not present (useful on initial tmux load)
if "test ! -d ~/.dotfiles/tmux/plugins/tpm" "run 'git clone https://github.com/tmux-plugins/tpm ~/.dotfiles/tmux/plugins/tpm && ~/.dotfiles/tmux/plugins/tpm/bin/install_plugins'"

run '$DOT/tmux/plugins/tpm/tpm'
